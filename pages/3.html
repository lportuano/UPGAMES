<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UPGAMES - Videojuego</title>

  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/tarjetas.css">
  <link rel="stylesheet" href="/css/comentarios.css">

</head>

<body>
  <header class="barra-navegacion">
    <div class="contenedor" style="display:flex; align-items:center; gap:20px; padding:12px 16px;">

      <img src="/imagenes/WhatsApp Image 2025-11-09 at 8.27.58 PM 1.jpeg" class alt="UpGames"
        style="width:80px; height:80px; border-radius:8px; object-fit:cover;" />

      <nav style="display:flex; gap:24px;">

        <a href="/index.html">
          <strong>Inicio</strong>
        </a>

        <a href="/pages/puzzle.html">
          <strong>Puzzle</strong>
        </a>

        <a href="/pages/accion.html">
          <strong>Accion</strong>
        </a>

        <a href="/pages/rompecabezas.html">
          <strong>Rompecabezas</strong>
        </a>

        <a href="/pages/comentarios.html">
          <strong>Comentarios</strong>
        </a>

      </nav>

    </div>
  </header>

  <main>
    <div class="content-container">
      <!-- Comentarios a la izquierda -->
      <div class="left-section" style="flex:1;">
        <div class="comentarios-container" style="display:flex; flex-direction:column; gap:16px;">

          <!-- Lista de comentarios -->
          <div class="comentarios-lista" id="lista-comentarios">
            <h3>Comentarios del juego</h3>
          </div>

          <!-- Formulario para a√±adir comentario -->
          <div class="formulario-comentario">
            <h3>A√±adir comentario</h3>
            <textarea id="nuevo-comentario" placeholder="Escribe tu rese√±a..."></textarea>
            <button onclick="agregarComentarioSeguro('3 en Raya')">Publicar</button>
            <div id="mensaje-error" style="color: red; margin-top: 10px; display: none;"></div>
          </div>
        </div>
      </div>

      <!-- SISTEMA DE CAPTURA DE ERRORES Y FILTRO DE OBSCENIDADES -->
      <script>
        // ==============================================
        // SISTEMA DE CAPTURA DE ERRORES GLOBAL
        // ==============================================
        (() => {
          'use strict';
          
          console.log('üéÆ Sistema de captura de errores activado para 3 en Raya');
          
          // 1. Capturar errores de JavaScript
          window.addEventListener('error', (event) => {
            console.error('üö® ERROR EN JUEGO:', {
              juego: '3 en Raya',
              mensaje: event.message,
              archivo: event.filename || 'Desconocido',
              linea: event.lineno,
              columna: event.colnum,
              error: event.error?.stack || 'Sin stack trace',
              hora: new Date().toLocaleTimeString()
            });
            
            event.preventDefault();
            return true;
          });
          
          // 2. Capturar promesas rechazadas
          window.addEventListener('unhandledrejection', (event) => {
            console.error('üö® PROMESA RECHAZADA EN JUEGO:', {
              juego: '3 en Raya',
              razon: event.reason?.message || event.reason || 'Raz√≥n desconocida',
              hora: new Date().toLocaleTimeString()
            });
          });
          
          // 3. Funci√≥n segura para usar en el juego
          window.ejecutarSeguro = (funcion, nombre = 'Funci√≥n del juego') => {
            try {
              return funcion();
            } catch (error) {
              console.error(`üö® ERROR EN ${nombre}:`, {
                mensaje: error.message,
                stack: error.stack,
                hora: new Date().toLocaleTimeString()
              });
              return null;
            }
          };
          
          console.log('‚úÖ Sistema listo para capturar errores');
        })();
      </script>

      <script>
        // ==============================================
        // SISTEMA DE FILTRO DE PALABRAS OBSCENAS
        // ==============================================
        
        // Lista de palabras prohibidas (puedes ampliar esta lista)
        const PALABRAS_PROHIBIDAS = [
          'idiota', 'est√∫pido', 'imb√©cil', 'tonto', 'mierda', 'carajo',
          'joder', 'co√±o', 'puta', 'cabr√≥n', 'pendejo', 'malparido',
          'hijueputa', 'marica', 'culero', 'verga', 'picha', 'concha',
          // Variaciones con asteriscos
          'id**ta', 'est****o', 'imb***il', 't**to', 'mier**', 'cara*o',
          'jo**r', 'co*o', 'pu*a', 'cab*√≥n', 'pend***o', 'malp****o',
          // Insultos comunes en juegos
          'noob', 'n00b', 'camper', 'hacker', 'cheater', 'tramposo'
        ];
        
        // Funci√≥n para detectar palabras obscenas
        function contienePalabrasObscenas(texto) {
          if (!texto) return false;
          
          const textoMinusculas = texto.toLowerCase();
          
          // Eliminar caracteres especiales para mejor detecci√≥n
          const textoLimpio = textoMinusculas
            .replace(/[^a-z0-9√°√©√≠√≥√∫√º√±\s]/g, '')
            .replace(/\s+/g, ' ');
          
          // Buscar palabras prohibidas
          for (const palabra of PALABRAS_PROHIBIDAS) {
            const regex = new RegExp(`\\b${palabra.replace(/\*/g, '.')}\\b`, 'i');
            if (regex.test(textoLimpio)) {
              return {
                encontrada: true,
                palabra: palabra,
                textoOriginal: texto
              };
            }
          }
          
          // Buscar intentos de evadir el filtro (letras repetidas, etc.)
          const patronesEvasion = [
            /(.)\1{3,}/g, // Letras repetidas m√°s de 3 veces: "estuuuuupido"
            /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]{3,}/g, // Muchos caracteres especiales
            /\b\w*[xX]{3,}\w*\b/g // Palabras con muchas X: "juegoxxxx"
          ];
          
          for (const patron of patronesEvasion) {
            if (patron.test(textoMinusculas)) {
              return {
                encontrada: true,
                palabra: 'PATR√ìN DE EVASI√ìN',
                textoOriginal: texto
              };
            }
          }
          
          return { encontrada: false };
        }
        
        // Funci√≥n para registrar error de obscenidad en consola
        function registrarErrorObscenidad(detalles) {
          const hora = new Date().toLocaleTimeString();
          const estiloTitulo = 'background: #ff0000; color: white; padding: 2px 6px; border-radius: 3px; font-weight: bold;';
          const estiloDetalle = 'color: #ff6b6b;';
          
          console.group(`üö´ ERROR: COMENTARIO OBSCENO - ${hora}`);
          console.log('%cINTENTO DE PUBLICAR COMENTARIO INAPROPIADO', estiloTitulo);
          console.log('%cPalabra prohibida detectada:', estiloDetalle, detalles.palabra);
          console.log('%cTexto del comentario:', estiloDetalle, detalles.textoOriginal);
          console.log('%cUsuario bloqueado:', estiloDetalle, 'Comentario no publicado');
          console.log('%cAcci√≥n tomada:', estiloDetalle, 'Filtro activado - Comentario rechazado');
          console.groupEnd();
          
          // Tambi√©n podemos guardar estos intentos
          guardarIntentoObscenidad(detalles);
        }
        
        // Funci√≥n para guardar intentos de obscenidad (opcional)
        function guardarIntentoObscenidad(detalles) {
          try {
            const intentos = JSON.parse(localStorage.getItem('upgames_intentos_obscenos')) || [];
            intentos.push({
              ...detalles,
              fecha: new Date().toISOString(),
              pagina: window.location.href
            });
            
            // Mantener solo los √∫ltimos 100 intentos
            if (intentos.length > 100) {
              intentos.splice(0, intentos.length - 100);
            }
            
            localStorage.setItem('upgames_intentos_obscenos', JSON.stringify(intentos));
          } catch (e) {
            console.log('No se pudo guardar el intento de obscenidad:', e);
          }
        }
        
        // Mostrar mensaje de error al usuario
        function mostrarErrorUsuario(mensaje) {
          const errorDiv = document.getElementById('mensaje-error');
          if (errorDiv) {
            errorDiv.textContent = mensaje;
            errorDiv.style.display = 'block';
            
            // Ocultar despu√©s de 5 segundos
            setTimeout(() => {
              errorDiv.style.display = 'none';
            }, 5000);
          }
        }
        
        // ==============================================
        // FUNCIONES DEL JUEGO MODIFICADAS
        // ==============================================
        
        function cargarComentarios(juego) {
          return window.ejecutarSeguro(() => {
            const comentarios = JSON.parse(localStorage.getItem('comentarios')) || {};
            const lista = document.getElementById('lista-comentarios');
            lista.innerHTML = '<h3>Comentarios del juego</h3>';
            
            if (comentarios[juego]) {
              // Filtrar comentarios aprobados (en caso de que haya viejos que ahora sean obscenos)
              const comentariosAprobados = comentarios[juego].filter(comentario => {
                return !contienePalabrasObscenas(comentario).encontrada;
              });
              
              comentariosAprobados.slice(-10).forEach(c => {
                lista.innerHTML += `<div class="comentario">${c}</div>`;
              });
            } else {
              lista.innerHTML += '<p>No hay comentarios a√∫n.</p>';
            }
            
            return comentarios[juego] || [];
          }, 'cargarComentarios');
        }
        
        function agregarComentarioSeguro(juego) {
          return window.ejecutarSeguro(() => {
            const textoInput = document.getElementById('nuevo-comentario');
            const texto = textoInput.value.trim();
            
            // Validaci√≥n b√°sica
            if (!texto) {
              mostrarErrorUsuario('Por favor, escribe un comentario');
              return false;
            }
            
            if (texto.length < 3) {
              mostrarErrorUsuario('El comentario debe tener al menos 3 caracteres');
              return false;
            }
            
            if (texto.length > 500) {
              mostrarErrorUsuario('El comentario no puede exceder los 500 caracteres');
              return false;
            }
            
            // Verificar palabras obscenas
            const resultadoFiltro = contienePalabrasObscenas(texto);
            
            if (resultadoFiltro.encontrada) {
              // REGISTRAR ERROR EN CONSOLA
              registrarErrorObscenidad(resultadoFiltro);
              
              // Mostrar mensaje al usuario (sin decir la palabra exacta)
              mostrarErrorUsuario('Tu comentario contiene lenguaje inapropiado. Por favor, modif√≠calo.');
              
              // Limpiar el campo (opcional)
              textoInput.value = '';
              textoInput.focus();
              
              return false;
            }
            
            // Si pasa el filtro, guardar el comentario
            const comentarios = JSON.parse(localStorage.getItem('comentarios')) || {};
            if (!comentarios[juego]) comentarios[juego] = [];
            comentarios[juego].push(texto);
            
            localStorage.setItem('comentarios', JSON.stringify(comentarios));
            textoInput.value = '';
            cargarComentarios(juego);
            
            // Mostrar mensaje de √©xito
            mostrarErrorUsuario('‚úÖ Comentario publicado exitosamente');
            document.getElementById('mensaje-error').style.color = 'green';
            
            setTimeout(() => {
              document.getElementById('mensaje-error').style.display = 'none';
            }, 3000);
            
            return true;
          }, 'agregarComentario');
        }
        
        // Funci√≥n original para compatibilidad
        function agregarComentario(juego) {
          return agregarComentarioSeguro(juego);
        }
        
        // ==============================================
        // INICIALIZACI√ìN
        // ==============================================
        
        document.addEventListener('DOMContentLoaded', () => {
          cargarComentarios('3 en Raya');
          
          // A√±adir evento de tecla Enter para publicar
          document.getElementById('nuevo-comentario').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              agregarComentarioSeguro('3 en Raya');
            }
          });
          
          // Mostrar mensaje de bienvenida del filtro
          console.log('üîí Filtro de lenguaje activado. Palabras prohibidas:', PALABRAS_PROHIBIDAS.length);
        });
        
        // ==============================================
        // FUNCIONES DE PRUEBA (para probar desde consola)
        // ==============================================
        
        // Funci√≥n para probar el filtro desde la consola
        window.probarFiltro = (texto) => {
          const resultado = contienePalabrasObscenas(texto);
          if (resultado.encontrada) {
            console.log(`üö´ Detectado: "${resultado.palabra}" en: "${texto}"`);
          } else {
            console.log(`‚úÖ Aprobado: "${texto}"`);
          }
          return resultado;
        };
        
        // Funci√≥n para ver intentos de obscenidad
        window.verIntentosObscenos = () => {
          const intentos = JSON.parse(localStorage.getItem('upgames_intentos_obscenos')) || [];
          console.log('üìä Intentos de comentarios obscenos:', intentos.length);
          intentos.forEach((intento, i) => {
            console.log(`Intento ${i + 1}:`, intento);
          });
          return intentos;
        };
        
        // Funci√≥n para limpiar intentos
        window.limpiarIntentosObscenos = () => {
          localStorage.removeItem('upgames_intentos_obscenos');
          console.log('üßπ Intentos de obscenidad limpiados');
        };
      </script>

      <div class="right-section">
        <div class="white-box">

          <div class="card">
            <h5 class="card-title">3 en Raya</h5>

            <figure class="figure">
              <img src="https://imagenes.cope.es/files/content_image/uploads/2024/07/10/668ea23fa1712.jpeg" alt="">
            </figure>

            <p class="card-p">
              Disfruta del cl√°sico juego de "3 en Raya", donde dos jugadores se turnan para colocar sus s√≠mbolos en una
              cuadr√≠cula de 3x3.
              El objetivo es alinear tres de sus s√≠mbolos en l√≠nea recta, ya sea horizontal, vertical o diagonalmente,
              antes que su oponente.
            </p>
            <br>
            <p class="card-p">¬°Aceptas el desaf√≠o</p>

            <a class="card-b" href="/juegos/7-Tres en raya/index.html" target="_blank" rel="noopener noreferrer">
              <button class="button">Juega</button>
            </a>

          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- C√ìDIGO PARA PROBAR (opcional - eliminar en producci√≥n) -->
  <script>
    // Prueba autom√°tica del sistema
    setTimeout(() => {
      console.log('=== PRUEBA DEL FILTRO DE OBSCENIDADES ===');
      console.log('Escribe en la consola: probarFiltro("tu texto aqu√≠")');
      console.log('Para ver intentos: verIntentosObscenos()');
      
      // Ejemplos de prueba
      const pruebas = [
        'Este juego es genial',
        'Eres un idiota',
        'Qu√© est√∫pido juego',
        'Me encanta, es divertido',
        'Qu√© mierda de juego',
        'Excelente trabajo'
      ];
      
      pruebas.forEach(texto => {
        const resultado = contienePalabrasObscenas(texto);
        if (resultado.encontrada) {
          console.log(`‚ùå Rechazado: "${texto}"`);
        } else {
          console.log(`‚úÖ Aprobado: "${texto}"`);
        }
      });
    }, 2000);
  </script>
  
</body>

</html>